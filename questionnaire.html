<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#ec4899">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="/favicon.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×©××œ×•×Ÿ ×©×•×ª×¤×” ×œ×“×¨×š - ×¤×•×¨×¦×•×ª ×“×¨×š</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 50% 50%, rgba(255,20,147,0.15) 0%, transparent 70%);
            pointer-events: none;
            animation: pulseGlow 4s ease-in-out infinite;
        }

        @keyframes pulseGlow {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        .container {
            max-width: 600px;
            width: 100%;
            position: relative;
            z-index: 1;
        }

        .card {
            background: rgba(20, 20, 20, 0.95);
            border: 2px solid #ff1493;
            border-radius: 24px;
            padding: 40px 32px;
            box-shadow: 0 0 40px rgba(255,20,147,0.3),
                        inset 0 0 60px rgba(255,20,147,0.05);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg,
                transparent 30%,
                rgba(255,20,147,0.1) 50%,
                transparent 70%);
            animation: rotate 8s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-bar {
            background: rgba(255,20,147,0.2);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 30px;
            position: relative;
            z-index: 2;
        }

        .progress-fill {
            background: linear-gradient(90deg, #ff1493, #ff69b4);
            height: 100%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px #ff1493;
        }

        .step {
            display: none;
            position: relative;
            z-index: 2;
            animation: fadeIn 0.5s ease;
        }

        .step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            color: #ff1493;
            text-shadow: 0 0 20px rgba(255,20,147,0.5);
            margin-bottom: 24px;
            font-size: 28px;
            text-align: center;
        }

        .question {
            margin-bottom: 24px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #ff69b4;
            font-weight: 500;
        }

        input[type="text"],
        select {
            width: 100%;
            padding: 12px;
            background: rgba(0,0,0,0.5);
            border: 1px solid #ff1493;
            border-radius: 8px;
            color: #fff;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus,
        select:focus {
            outline: none;
            border-color: #ff69b4;
            box-shadow: 0 0 15px rgba(255,20,147,0.5);
        }

        select option {
            background: #1a1a1a;
            color: #fff;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 32px;
            justify-content: space-between;
        }

        button {
            flex: 1;
            padding: 14px 28px;
            background: linear-gradient(135deg, #ff1493, #ff69b4);
            color: #fff;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255,20,147,0.4);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,20,147,0.6);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        button:active:not(:disabled) {
            transform: translateY(0px) scale(0.97);
            box-shadow: 0 2px 10px rgba(255,20,147,0.3);
        }

        button.secondary {
            background: rgba(255,20,147,0.2);
            border: 1px solid #ff1493;
        }

        .warning {
            background: rgba(255,50,50,0.2);
            border: 1px solid #ff3232;
            border-radius: 8px;
            padding: 12px;
            margin-top: 16px;
            color: #ff6b6b;
            display: none;
        }

        .warning.show {
            display: block;
            animation: shake 0.5s;
        }

        /* Choice Group Styles */
        .choice-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 12px;
            margin-bottom: 24px;
        }

        .choice {
            background: rgba(255,20,147,0.1);
            border: 2px solid rgba(255,20,147,0.3);
            border-radius: 12px;
            padding: 16px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: right;
            font-size: 16px;
            line-height: 1.5;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .choice:hover {
            background: rgba(255,20,147,0.2);
            border-color: #ff1493;
            transform: translateX(-3px) scale(1.01);
        }

        .choice.selected {
            background: linear-gradient(135deg, rgba(255,20,147,0.4), rgba(255,105,180,0.4));
            border: 3px solid #ff1493;
            box-shadow: 0 0 30px rgba(255,20,147,0.6), inset 0 0 20px rgba(255,20,147,0.2);
            transform: translateX(-5px) scale(1.02);
            font-weight: 600;
        }

        .choice.selected::after {
            content: 'âœ“';
            position: absolute;
            left: 20px;
            font-size: 24px;
            font-weight: bold;
            color: #ff1493;
            text-shadow: 0 0 10px rgba(255,20,147,0.8);
            animation: checkmark 0.4s ease;
        }

        @keyframes checkmark {
            0% { transform: scale(0) rotate(-45deg); opacity: 0; }
            50% { transform: scale(1.3) rotate(5deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .card h2 {
            margin-bottom: 8px;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .logo {
            text-align: center;
            margin-bottom: 20px;
            color: #ff1493;
            text-shadow: 0 0 20px rgba(255,20,147,0.7);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        @media (max-width: 768px) {
            .card { padding: 32px 24px; }
            h2 { font-size: 24px; }
            .button-group { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="logo">
                <h1>ğŸŒŸ ×©××œ×•×Ÿ ×©×•×ª×¤×” ×œ×“×¨×š ğŸŒŸ</h1>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>

            <!-- ×©×œ×‘ 1 -->
            <div class="step active" id="step1">
                <h2>×œ×¤× ×™ ×©××ª×—×™×œ×•×ª</h2>
                <div class="question">
                    <label>×©× ×¤×¨×˜×™ / ×›×™× ×•×™ (×›×“×™ ×©×ª×•×›×œ×™ ×œ×–×”×•×ª ××ª ×¢×¦××š ×‘××¡×š ×”×—×™×‘×•×¨×™×)</label>
                    <input type="text" id="displayName" placeholder="×œ×“×•×’××”: × ×•×¢×”" maxlength="24">
                </div>

                <h2 style="margin-top:18px">×ª×—×•××™ ×¢× ×™×™×Ÿ</h2>
                <div class="question">
                    <label>×ª×—×•× ××¨×›×–×™ ×œ×ª×”×œ×™×š</label>
                    <div class="choice-group" data-field="mainDomain">
                        <div class="choice">×ª×—×•×©×ª ×’×•×£</div>
                        <div class="choice">×—×™×™× ×“×™×’×™×˜×œ×™×™×</div>
                        <div class="choice">×œ××™×“×” ×‘×œ×—×¥</div>
                        <div class="choice">×—×™×™× ×—×‘×¨×ª×™×™×</div>
                        <div class="choice">×‘×—×™×¨×•×ª ×™×•××™×•××™×•×ª</div>
                        <div class="choice">×¤× ××™ ×•×™×¦×™×¨×”</div>
                        <div class="choice">×¡×‘×™×‘×” ×•×—×™×•×ª</div>
                        <div class="choice">×”×‘×™×ª ×©×œ×™</div>
                        <div class="choice">××¨×—×‘ ×•×ª× ×•×¢×”</div>
                        <div class="choice">××‘×˜ ×§×“×™××”</div>
                    </div>

                    <label>×ª×—×•× × ×•×¡×£ ×©××¢× ×™×™×Ÿ ××•×ª×š</label>
                    <div class="choice-group" data-field="secondDomain">
                        <div class="choice">×ª×—×•×©×ª ×’×•×£</div>
                        <div class="choice">×—×™×™× ×“×™×’×™×˜×œ×™×™×</div>
                        <div class="choice">×œ××™×“×” ×‘×œ×—×¥</div>
                        <div class="choice">×—×™×™× ×—×‘×¨×ª×™×™×</div>
                        <div class="choice">×‘×—×™×¨×•×ª ×™×•××™×•××™×•×ª</div>
                        <div class="choice">×¤× ××™ ×•×™×¦×™×¨×”</div>
                        <div class="choice">×¡×‘×™×‘×” ×•×—×™×•×ª</div>
                        <div class="choice">×”×‘×™×ª ×©×œ×™</div>
                        <div class="choice">××¨×—×‘ ×•×ª× ×•×¢×”</div>
                        <div class="choice">××‘×˜ ×§×“×™××”</div>
                        <div class="choice">×× ×™ ××¢×“×™×¤×” ×œ×”×ª××§×“ ×‘×ª×—×•× ××—×“</div>
                    </div>
                </div>

                <div class="warning" id="warning1">×× × ×¢× ×” ×¢×œ ×›×œ ×”×©××œ×•×ª ×œ×¤× ×™ ×”××©×š</div>
                <div class="button-group">
                    <button onclick="nextStep()">×”××©×š â†’</button>
                </div>
            </div>

            <!-- ×©×œ×‘ 2 -->
            <div class="step" id="step2">
                <h2>××™×š ××ª ×¤×•×¢×œ×ª?</h2>
                
                <div class="question">
                    <label>×›×©×™×© ××©×™××” ×—×“×©×” ×•×œ× ×‘×¨×•×¨×”:</label>
                    <div class="choice-group" data-field="workStyle">
                        <div class="choice">××ª×—×™×œ×” ×œ×”×ª× ×¡×•×ª ×•×œ×•××“×ª ×ª×•×š ×›×“×™</div>
                        <div class="choice">×¢×•×¦×¨×ª ×§×•×“× ×œ×”×‘×™×Ÿ ×œ×¢×•××§ ×•×œ×ª×›× ×Ÿ</div>
                    </div>

                    <label>×›×©×¢×•×‘×“×ª ×¢× ×©×•×ª×¤×”:</label>
                    <div class="choice-group" data-field="teamStyle">
                        <div class="choice">×—×•×©×‘×ª ×‘×§×•×œ ×¨× ×•××©×ª×¤×ª ×›×œ ×¨×¢×™×•×Ÿ</div>
                        <div class="choice">××¢×“×™×¤×” ×œ×¢×‘×•×“ ×‘×©×§×˜ ×•××– ×œ×”×¦×™×’</div>
                    </div>

                    <label>×§×¦×‘ ×¢×‘×•×“×” ×˜×‘×¢×™:</label>
                    <div class="choice-group" data-field="workPace">
                        <div class="choice">××•×”×‘×ª ×œ×¢×‘×•×“ ××”×¨ ×•×œ×¡×™×™× ××•×§×“×</div>
                        <div class="choice">××¢×“×™×¤×” ×œ×§×—×ª ×–××Ÿ ×•×œ×¢×©×•×ª ×‘×“×™×•×§</div>
                        <div class="choice">×ª×œ×•×™ ×‘××©×™××” â€“ ×’××™×©×”</div>
                    </div>
                </div>

                <div class="warning" id="warning2">×× × ×¢× ×” ×¢×œ ×›×œ ×”×©××œ×•×ª ×œ×¤× ×™ ×”××©×š</div>
                <div class="button-group">
                    <button class="secondary" onclick="prevStep()">â† ×—×–×¨×”</button>
                    <button onclick="nextStep()">×”××©×š â†’</button>
                </div>
            </div>

            <!-- ×©×œ×‘ 3 -->
            <div class="step" id="step3">
                <h2>×”×ª×¤×§×™×“ ×©×œ×š ×‘×¦×•×•×ª</h2>

                <div class="question">
                    <label>×‘××™×–×” ×ª×¤×§×™×“ ××ª ×”×›×™ ×˜×•×‘×”?</label>
                    <div class="choice-group" data-field="teamRole">
                        <div class="choice">×œ××¦×•× ×¨×¢×™×•× ×•×ª ××§×•×¨×™×™× ×•×œ×”×ª×—×™×œ ×“×‘×¨×™× ×—×“×©×™×</div>
                        <div class="choice">×œ××¨×’×Ÿ ××©×™××•×ª ×•×œ×•×•×“× ×©×”×›×•×œ ×–×•×¨× ×‘×–××Ÿ</div>
                        <div class="choice">×œ×¢×–×•×¨ ×œ××—×¨×•×ª ×œ×”×‘×™×Ÿ ×•×œ×”×¡×‘×™×¨ ××•×©×’×™× ××•×¨×›×‘×™×</div>
                        <div class="choice">×œ×¤×ª×•×¨ ×‘×¢×™×•×ª ×˜×›× ×™×•×ª ×›×©××©×”×• ×ª×§×•×¢</div>
                    </div>

                    <label>××” ×¢×•×–×¨ ×œ×š ×œ×”×ª××™×“ ×‘×¤×¨×•×™×§×˜?</label>
                    <div class="choice-group" data-field="motivationSource">
                        <div class="choice">×ª×—×•×©×ª ××©××¢×•×ª â€“ ××©×”×• ×—×©×•×‘</div>
                        <div class="choice">××ª×’×¨ ××™× ×˜×œ×§×˜×•××œ×™ â€“ ×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª</div>
                        <div class="choice">×¢×‘×•×“×ª ×¦×•×•×ª â€“ ×—×™×‘×•×¨ ×¢× ×× ×©×™×</div>
                        <div class="choice">×”×ª×•×¦××” ×”×¡×•×¤×™×ª â€“ ×œ×¨××•×ª ××•×¦×¨ ××•×›×Ÿ</div>
                    </div>
                </div>

                <div class="warning" id="warning3">×× × ×¢× ×” ×¢×œ ×›×œ ×”×©××œ×•×ª ×œ×¤× ×™ ×”××©×š</div>
                <div class="button-group">
                    <button class="secondary" onclick="prevStep()">â† ×—×–×¨×”</button>
                    <button onclick="nextStep()">×”××©×š â†’</button>
                </div>
            </div>

            <!-- ×©×œ×‘ 4 -->
            <div class="step" id="step4">
                <h2>×ª×§×©×•×¨×ª ×•×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª</h2>

                <div class="question">
                    <label>×›×©×™×© ×“×“×œ×™×™×Ÿ ×•×œ×—×¥:</label>
                    <div class="choice-group" data-field="pressureResponse">
                        <div class="choice">×¤×•×¢×œ×ª ×”×›×™ ×˜×•×‘ ×ª×—×ª ×œ×—×¥</div>
                        <div class="choice">×¦×¨×™×›×” ×œ×ª×›× ×Ÿ ××¨××© ×›×“×™ ×œ×× ×•×¢ ×œ×—×¥</div>
                        <div class="choice">×œ×•×§×—×ª ×”×¤×¡×§×” ×•××– ×—×•×–×¨×ª</div>
                    </div>

                    <label>×›×©×™×© ××™Ö¾×”×¡×›××” ×¢× ×©×•×ª×¤×”:</label>
                    <div class="choice-group" data-field="conflictStyle">
                        <div class="choice">×¢×•×¦×¨×ª ×œ×”×‘×™×Ÿ ××ª ×”×¦×“ ×”×©× ×™</div>
                        <div class="choice">××¦×™×’×” ×¢××“×” ×•×× ×¡×” ×œ×©×›× ×¢</div>
                        <div class="choice">××—×¤×©×ª ×¤×©×¨×”</div>
                    </div>

                    <label>××™×š × ×•×— ×œ×š ×œ×ª×§×©×¨ ×‘×™×Ÿ ××¤×’×©×™×?</label>
                    <div class="choice-group" data-field="communicationStyle">
                        <div class="choice">×¤×’×™×©×•×ª ×¤× ×™× ××œ ×¤× ×™× ×‘×œ×‘×“</div>
                        <div class="choice">×©×™×—×•×ª ×•×™×“××• ××• ×˜×œ×¤×•×Ÿ</div>
                        <div class="choice">×”×•×“×¢×•×ª ×˜×§×¡×˜ ×•×§×‘×¦×™× ××©×•×ª×¤×™×</div>
                        <div class="choice">×’××™×©×”</div>
                    </div>

                    <label>××™×–×” ×ª×•×›×Ÿ ××•×©×š ××•×ª×š ×‘×™×•×Ö¾×™×•×?</label>
                    <div class="choice-group" data-field="lifeInterest">
                        <div class="choice">×”×’×•×£, ×ª×—×•×©×•×ª ×•××” ×©×¢×•×‘×¨ ×¢×œ×™×™</div>
                        <div class="choice">××¡×›×™×, ×¨×©×ª×•×ª ×•×—×™×™× ×“×™×’×™×˜×œ×™×™×</div>
                        <div class="choice">×§×©×¨×™×, ×—×‘×¨×•×ª ×•×“×™× ××™×§×” ×—×‘×¨×ª×™×ª</div>
                        <div class="choice">×‘×™×ª, ××¨×—×‘ ××™×©×™ ×•×ª× ×•×¢×”</div>
                        <div class="choice">×˜×‘×¢, ×¡×‘×™×‘×” ×•×—×™×•×ª</div>
                        <div class="choice">×™×¦×™×¨×”, ×–××Ÿ ×¤× ×•×™ ×•×“××™×•×Ÿ</div>
                        <div class="choice">××—×©×‘×•×ª ×¢×œ ×¢×ª×™×“ ×•×”×‘×—×™×¨×•×ª ×©×œ×™</div>
                    </div>
                </div>

                <div class="warning" id="warning4">×× × ×¢× ×” ×¢×œ ×›×œ ×”×©××œ×•×ª ×œ×¤× ×™ ×”××©×š</div>
                <div class="button-group">
                    <button class="secondary" onclick="prevStep()">â† ×—×–×¨×”</button>
                    <button onclick="nextStep()">×”××©×š â†’</button>
                </div>
            </div>

            <!-- ×©×œ×‘ 5 - ××•×¤×¦×™×•× ×œ×™ -->
            <div class="step" id="step5">
                <h2>×©××œ×” ××—×¨×•× ×”</h2>

                <div class="question">
                    <label>×›××” ×—×©×•×‘ ×œ×š ×œ×”×ª××™× ×¢× ×”×©×•×ª×¤×”?</label>
                    <div class="choice-group" data-field="importanceLevel">
                        <div class="choice">×××•×“ ×—×©×•×‘ â€“ ×¨×•×¦×” ×”×ª×××” ×”×›×™ ×˜×•×‘×”</div>
                        <div class="choice">×§×¦×ª ×—×©×•×‘ â€“ ×™×›×•×œ×” ×œ×”×¡×ª×“×¨ ×¢× ×›×•×œ×Ÿ</div>
                        <div class="choice">×œ× ×›×œ ×›×š ×—×©×•×‘ â€“ ×’××™×©×”</div>
                    </div>
                </div>

                <div class="warning" id="warning5">×× × ×¢× ×” ×¢×œ ×›×œ ×”×©××œ×•×ª ×œ×¤× ×™ ×”××©×š</div>
                <div class="button-group">
                    <button class="secondary" onclick="prevStep()">â† ×—×–×¨×”</button>
                    <button onclick="finish()">×¡×™×™××ª×™ - ××•×›× ×” ×œ×©×•×ª×¤×•×ª</button>
                </div>
            </div>

            <div class="loading" id="loading">
                <p>×©×•××¨ ××ª ×”×ª×©×•×‘×•×ª ×©×œ×š...</p>
            </div>

            <div class="loading" id="loading">
                <p>×©×•××¨ ××ª ×”×ª×©×•×‘×•×ª ×©×œ×š...</p>
            </div>
        </div>
    </div>

    <!-- Firebase Firestore -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, doc, setDoc, updateDoc, increment } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCFSq5b-HgkTxFNhBJIBdOe2ian5TZvMPE",
            authDomain: "portzot-derech.firebaseapp.com",
            projectId: "portzot-derech",
            storageBucket: "portzot-derech.firebasestorage.app",
            messagingSenderId: "236417614890",
            appId: "1:236417614890:web:587b0eb3c5eedfa352af53"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        db._settings.experimentalForceLongPolling = true;
        console.log("âœ… Firestore connection: OK");

        // Get sessionId from URL
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session');

        if (!sessionId) {
            alert('×©×’×™××”: ×œ× × ××¦× ×§×•×“ ×¤×¢×™×œ×•×ª');
            window.location.href = 'pairing.html';
        }

        let currentStep = 1;
        const totalSteps = 5;

        // ××•×‘×™×™×§×˜ ×œ×©××™×¨×ª ×‘×—×™×¨×•×ª ×”××©×ª××©
        const selections = {};

        // ×˜×™×¤×•×œ ×‘-choice-group clicks
        document.addEventListener('DOMContentLoaded', function() {
            console.log('âœ… DOM × ×˜×¢×Ÿ!');
            const choiceGroups = document.querySelectorAll('.choice-group');
            
            console.log('ğŸ” × ××¦××•', choiceGroups.length, '×§×‘×•×¦×•×ª ×‘×—×™×¨×”');
            
            if (choiceGroups.length === 0) {
                console.error('âŒ ×œ× × ××¦××• choice-groups! ×‘×•×“×§ HTML...');
            }
            
            choiceGroups.forEach(group => {
                const field = group.getAttribute('data-field');
                const choices = group.querySelectorAll('.choice');
                
                console.log('ğŸ“Œ ××’×“×™×¨ listeners ×œ:', field, '- ', choices.length, '××¤×©×¨×•×™×•×ª');
                
                choices.forEach(choice => {
                    choice.addEventListener('click', function() {
                        console.log('ğŸ‘† × ×œ×—×¥:', this.textContent.trim());
                        
                        // ×× ×™××¦×™×” ××™×™×“×™×ª
                        this.style.transform = 'scale(0.95)';
                        setTimeout(() => {
                            this.style.transform = '';
                        }, 150);
                        
                        // ×”×¡×¨×ª selected ××›×œ ×”××¤×©×¨×•×™×•×ª ×‘×§×‘×•×¦×”
                        choices.forEach(c => c.classList.remove('selected'));
                        
                        // ×”×•×¡×¤×ª selected ×œ××¤×©×¨×•×ª ×©× ×‘×—×¨×”
                        this.classList.add('selected');
                        
                        // ×©××™×¨×ª ×”×‘×—×™×¨×”
                        selections[field] = this.textContent.trim();
                        
                        console.log('ğŸ’¾ × ×©××¨:', field, '=', selections[field]);
                    });
                });
            });
        });

        window.nextStep = function() {
            if (!validateStep(currentStep)) {
                document.getElementById(`warning${currentStep}`).classList.add('show');
                setTimeout(() => {
                    document.getElementById(`warning${currentStep}`).classList.remove('show');
                }, 3000);
                return;
            }

            if (currentStep < totalSteps) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                currentStep++;
                document.getElementById(`step${currentStep}`).classList.add('active');
                updateProgress();
            }
        };

        window.prevStep = function() {
            if (currentStep > 1) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                currentStep--;
                document.getElementById(`step${currentStep}`).classList.add('active');
                updateProgress();
            }
        };

        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function validateStep(step) {
            const displayName = document.getElementById('displayName');
            
            switch(step) {
                case 1:
                    return displayName.value.trim() !== '' &&
                           selections.mainDomain &&
                           selections.secondDomain;
                case 2:
                    return selections.workStyle &&
                           selections.teamStyle &&
                           selections.workPace;
                case 3:
                    return selections.teamRole &&
                           selections.motivationSource;
                case 4:
                    return selections.pressureResponse &&
                           selections.conflictStyle &&
                           selections.communicationStyle &&
                           selections.lifeInterest;
                case 5:
                    return selections.importanceLevel;
                default:
                    return false;
            }
        }

        function getDeviceId() {
            let deviceId = localStorage.getItem('deviceId');
            if (!deviceId) {
                deviceId = crypto.randomUUID();
                localStorage.setItem('deviceId', deviceId);
            }
            return deviceId;
        }

        window.finish = async function() {
            if (!validateStep(5)) {
                document.getElementById('warning5').classList.add('show');
                setTimeout(() => {
                    document.getElementById('warning5').classList.remove('show');
                }, 3000);
                return;
            }

            document.getElementById('loading').style.display = 'block';

            const payload = {
                sessionId: sessionId,
                deviceId: getDeviceId(),
                displayName: document.getElementById('displayName').value.trim(),
                mainDomain: selections.mainDomain,
                secondDomain: selections.secondDomain,
                workStyle: selections.workStyle,
                teamStyle: selections.teamStyle,
                workPace: selections.workPace,
                teamRole: selections.teamRole,
                motivationSource: selections.motivationSource,
                pressureResponse: selections.pressureResponse,
                conflictStyle: selections.conflictStyle,
                communicationStyle: selections.communicationStyle,
                lifeInterest: selections.lifeInterest,
                importanceLevel: selections.importanceLevel,
                createdAt: new Date().toISOString()
            };

            try {
                // ×©××™×¨×ª ×”×ª×©×•×‘×”
                const responseId = crypto.randomUUID();
                await setDoc(doc(db, 'responses', responseId), payload);

                // ×¢×“×›×•×Ÿ ×”××•× ×”
                const sessionRef = doc(db, 'sessions', sessionId);
                await updateDoc(sessionRef, {
                    completedCount: increment(1)
                });

                // ×©××™×¨×ª ×”×©× ×‘-localStorage ğŸ’
                const displayName = document.getElementById('displayName').value.trim();
                localStorage.setItem('displayName', displayName);
                console.log('ğŸ’¾ ×©× × ×©××¨:', displayName);

                // ×”×¦×œ×—×”!
                console.log('âœ… ×”×ª×©×•×‘×•×ª × ×©××¨×•! ××¢×‘×™×¨ ×œ×¢××•×“ ×”××ª× ×”...');
                window.location.href = `waiting.html?session=${sessionId}`;
            } catch (error) {
                console.error('Error:', error);
                alert('×©×’×™××” ×‘×©××™×¨×ª ×”×ª×©×•×‘×•×ª. ×× × × ×¡×™ ×©×•×‘.');
                document.getElementById('loading').style.display = 'none';
            }
        };

    </script>
</body>
</html>
                                                 